{% comment %}
Memory Metric Component Template

Required variables:
- server_id: Server ID
- metric_data: Dictionary with memory_percent, memory_total, memory_available, memory_cached, swap_total, swap_used, top_processes (optional)
- compact_mode: Boolean for compact display (default: False)
- show_header: Boolean to show header (default: True)
{% endcomment %}

{% load static %}

<div class="metric-component{% if compact_mode %} compact{% endif %}" 
     id="metric-memory-{{ server_id }}"
     data-metric-type="memory"
     data-server-id="{{ server_id }}">
    
    {% if show_header|default:True %}
    <h2 class="metric-component-header">RAM</h2>
    {% endif %}
    
    <div class="metric-content">
        {% if compact_mode %}
            <!-- Compact mode for dashboard cards -->
            <div class="metric-main-value" id="memory-main-{{ server_id }}">
                {{ metric_data.memory_percent|default:"--"|floatformat:"0" }}%
            </div>
        {% else %}
            <!-- Full mode for server details page -->
            <div class="metric-sub-grid">
                <div class="metric-sub-item">
                    <div class="metric-sub-label">Total RAM</div>
                    <div class="metric-sub-value" id="ram-total-{{ server_id }}">
                        {{ metric_data.memory_total|filesizeformat|default:"--" }}
                    </div>
                </div>
                <div class="metric-sub-item">
                    <div class="metric-sub-label">Free RAM</div>
                    <div class="metric-sub-value" id="ram-free-{{ server_id }}">
                        {{ metric_data.memory_available|filesizeformat|default:"--" }}
                    </div>
                </div>
                <div class="metric-sub-item">
                    <div class="metric-sub-label">Cached</div>
                    <div class="metric-sub-value" id="ram-cached-{{ server_id }}">
                        {{ metric_data.memory_cached|filesizeformat|default:"--" }}
                    </div>
                </div>
                {% if metric_data.swap_total %}
                <div class="metric-sub-item">
                    <div class="metric-sub-label">Swap (Total/Used)</div>
                    <div class="metric-sub-value" id="swap-info-{{ server_id }}">
                        {{ metric_data.swap_total|filesizeformat }} / {{ metric_data.swap_used|default:0|filesizeformat }}
                    </div>
                </div>
                {% endif %}
            </div>
            
            {% if metric_data.top_processes %}
            <div class="metric-processes">
                <div class="metric-processes-title">Top 3 RAM Processes</div>
                <div class="metric-process-list" id="top-ram-processes-{{ server_id }}">
                    {% for process in metric_data.top_processes|slice:":3" %}
                    <div class="metric-process-item">
                        <span class="metric-process-name">{{ process.name|truncatechars:40 }}</span>
                        <span class="metric-process-value">{{ process.memory|filesizeformat }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            <div class="metric-processes">
                <div class="metric-processes-title">Top 3 RAM Processes</div>
                <div class="metric-process-list" id="top-ram-processes-{{ server_id }}">
                    <div class="metric-process-item">Loading...</div>
                </div>
            </div>
            {% endif %}
        {% endif %}
    </div>
    
    <div class="metric-loading" id="metric-loading-memory-{{ server_id }}" style="display: none;">
        Loading...
    </div>
    
    <div class="metric-error" id="metric-error-memory-{{ server_id }}" style="display: none;">
        <span id="metric-error-message-memory-{{ server_id }}"></span>
    </div>
</div>




