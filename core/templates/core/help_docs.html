{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}Help Documentation - StackSense{% endblock %}

{% block extrahead %}
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    :root {
        --primary-color: #c9a961;
        --success-color: #10b981;
        --warning-color: #f59e0b;
        --danger-color: #ef4444;
        --bg-light: #0f172a;
        --bg-dark: #1e293b;
        --card-bg: #1e293b;
        --text-primary: #f1f5f9;
        --text-secondary: #cbd5e1;
        --text-muted: #94a3b8;
        --border-color: #334155;
    }

    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    html, body {
        background: #0f172a !important;
        color: #f1f5f9 !important;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        min-height: 100vh;
    }

    /* Top-Right Navigation */
    .top-right-nav {
        position: fixed;
        top: 0;
        right: 1rem;
        z-index: 1000;
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 0.75rem 1rem;
        background: rgba(15, 23, 42, 0.95);
        backdrop-filter: blur(10px);
        border-bottom-left-radius: 8px;
        border-bottom-right-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    .top-right-nav .username {
        color: var(--text-primary);
        font-size: 0.875rem;
        font-weight: 500;
    }

    .logout-btn {
        padding: 6px 12px;
        background: #e63946;
        color: white;
        border: none;
        border-radius: 4px;
        text-decoration: none;
        font-size: 0.875rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .logout-btn:hover {
        background: #d62839;
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(230, 57, 70, 0.3);
    }

    .logout-btn:active {
        transform: translateY(0);
    }

    /* Sidebar */
    .sidebar {
        position: fixed;
        left: 0;
        top: 0;
        height: 100vh;
        width: 240px !important;
        background: var(--card-bg);
        border-right: 1px solid rgba(255, 255, 255, 0.1);
        z-index: 1000;
        overflow: hidden;
        overflow-y: auto;
        box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
    }

    .sidebar-content {
        padding: 1rem 0;
        min-height: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        box-sizing: border-box;
    }

    .sidebar-item {
        display: flex;
        align-items: center;
        padding: 0.75rem 1rem;
        color: rgba(255, 255, 255, 0.7);
        cursor: pointer;
        transition: all 0.2s ease;
        gap: 0.75rem;
        white-space: nowrap;
        border-left: 3px solid transparent;
        text-decoration: none;
    }

    .sidebar-item:hover {
        background: rgba(255, 255, 255, 0.05);
        border-left-color: var(--primary-color);
        color: var(--text-primary);
    }

    .sidebar-item-icon {
        width: 20px;
        height: 20px;
        flex-shrink: 0;
    }

    .sidebar-item-icon svg {
        width: 100%;
        height: 100%;
        fill: currentColor;
    }

    .sidebar-item-text {
        opacity: 1;
        font-size: 0.875rem;
        font-weight: 500;
    }

    

    .sidebar-divider {
        height: 1px;
        background: rgba(255, 255, 255, 0.1);
        margin: 0.5rem 1rem;
    }

    /* Sidebar Groups */
    .sidebar-group {
        margin-bottom: 0.5rem;
    }

    .sidebar-group-header {
        padding: 0.5rem 1rem;
        color: rgba(255, 255, 255, 0.5);
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        opacity: 0;
        transition: opacity 0.2s ease;
    }

    .sidebar.expanded .sidebar-group-header,
    .sidebar:hover .sidebar-group-header {
        opacity: 1;
    }

    .sidebar-group-items {
        display: flex;
        flex-direction: column;
    }

    .sidebar-group-items .sidebar-item {
        padding-left: 2rem;
        font-size: 0.875rem;
    }

    .help-container {
        margin-left: 240px; /* Space for expanded sidebar */
        padding: 2rem;
        max-width: 1200px;
    }

    /* Mobile responsiveness */
    @media (max-width: 768px) {
        .sidebar {
            width: 60px !important;
        }
        .sidebar-item-text {
            opacity: 0;
            width: 0;
            overflow: hidden;
        }
        .sidebar-group-header {
            opacity: 0;
        }
        .help-container {
            margin-left: 60px !important;
        }
    }

    .help-header {
        margin-bottom: 2rem;
    }

    .help-header h1 {
        font-size: 2rem;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 0.5rem;
    }

    .help-section {
        background: rgba(30, 41, 59, 0.4);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.18);
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .help-section h2 {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 1rem;
        border-bottom: 2px solid var(--primary-color);
        padding-bottom: 0.5rem;
    }

    .help-section h3 {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-top: 1.5rem;
        margin-bottom: 0.75rem;
    }

    .help-section p {
        color: var(--text-secondary);
        line-height: 1.6;
        margin-bottom: 1rem;
    }

    .help-section ul {
        color: var(--text-secondary);
        line-height: 1.8;
        margin-left: 1.5rem;
        margin-bottom: 1rem;
    }

    .help-section li {
        margin-bottom: 0.5rem;
    }

    .feature-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
    }

    .feature-card {
        background: rgba(15, 23, 42, 0.5);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 1rem;
    }

    .feature-card h4 {
        color: var(--primary-color);
        margin-bottom: 0.5rem;
    }

    .feature-card p {
        font-size: 0.9rem;
        margin: 0;
    }
</style>
{% endblock %}

{% block content %}
<!-- Top-Right Navigation -->
<div class="top-right-nav">
    <span class="username">{{ user.username }}</span>
    <form action="{% url 'logout' %}" method="post" style="margin: 0; padding: 0; display: inline;">
        {% csrf_token %}
        <button type="submit" class="logout-btn">Logout</button>
    </form>
</div>

<!-- Sidebar -->
{% include 'core/sidebar.html' %}

<div class="help-container">
    <div class="help-header">
        <h1>StackSense Help Documentation</h1>
        <p style="color: var(--text-secondary);">Comprehensive guide to using StackSense monitoring platform</p>
    </div>

    <div class="help-section">
        <h2>Getting Started</h2>
        <p>StackSense is a comprehensive server monitoring and infrastructure management platform that helps you track the health and performance of your servers in real-time.</p>
        
        <h3>Dashboard Overview</h3>
        <p>The main dashboard provides a quick overview of all your monitored servers. Each server card displays:</p>
        <ul>
            <li><strong>Server Status:</strong> Online, Warning, or Offline indicators</li>
            <li><strong>Resource Metrics:</strong> CPU, Memory, and Disk usage percentages</li>
            <li><strong>Uptime:</strong> How long the server has been running</li>
            <li><strong>Anomaly Status:</strong> Current anomaly detection status with severity levels</li>
        </ul>
    </div>

    <div class="help-section">
        <h2>Server Management</h2>
        
        <h3>Adding a Server</h3>
        <p>To monitor a new server, navigate to "Manage Servers" → "Add Server" in the sidebar. You'll need:</p>
        <ul>
            <li>Server IP address or hostname</li>
            <li>SSH port (default: 22)</li>
            <li>SSH username</li>
            <li>SSH key authentication (recommended)</li>
        </ul>

        <h3>Server Details</h3>
        <p>Click on any server card to view detailed metrics including:</p>
        <ul>
            <li>Real-time CPU and Memory usage</li>
            <li>Disk storage breakdown by partition</li>
            <li>Performance trends and historical data</li>
            <li>Active services and their status</li>
            <li>Anomaly history and alerts</li>
        </ul>

        <h3>Monitoring Controls</h3>
        <p>Each server has monitoring controls:</p>
        <ul>
            <li><strong>Halt Monitoring:</strong> Temporarily pause metric collection</li>
            <li><strong>Mute Alerts:</strong> Suppress alert notifications while keeping monitoring active</li>
        </ul>
    </div>

    <div class="help-section">
        <h2>Anomaly Detection</h2>
        <p>StackSense uses advanced machine learning to detect anomalies in your server metrics.</p>
        
        <h3>Anomaly Summary</h3>
        <p>The Anomaly Summary panel shows:</p>
        <ul>
            <li><strong>Highest Severity:</strong> The most critical anomaly currently detected</li>
            <li><strong>Active Count:</strong> Number of unresolved anomalies</li>
            <li><strong>Per-Metric Status:</strong> Which metrics (CPU, Memory, Disk, Network) have anomalies</li>
        </ul>

        <h3>Anomaly History Chart</h3>
        <p>The Metrics & Anomaly History chart visualizes:</p>
        <ul>
            <li>CPU, Memory, and Disk usage over time</li>
            <li>Anomaly events overlaid as colored points</li>
            <li>Severity-based color coding (Low, Medium, High, Critical)</li>
        </ul>

        <h3>Severity Levels</h3>
        <ul>
            <li><strong>OK:</strong> No anomalies detected</li>
            <li><strong>LOW:</strong> Minor deviation from normal patterns</li>
            <li><strong>MEDIUM:</strong> Moderate anomaly requiring attention</li>
            <li><strong>HIGH:</strong> Significant anomaly that may impact performance</li>
            <li><strong>CRITICAL:</strong> Severe anomaly requiring immediate action</li>
        </ul>
    </div>

    <div class="help-section">
        <h2>Service Monitoring</h2>
        <p>Monitor critical services running on your servers.</p>
        
        <h3>Enabling Service Monitoring</h3>
        <p>On the server details page, you can:</p>
        <ul>
            <li>View all detected services</li>
            <li>Enable monitoring for specific services</li>
            <li>Track service status (Running, Stopped, Failed)</li>
            <li>Monitor service uptime</li>
        </ul>

        <h3>Service Categories</h3>
        <p>Services are automatically categorized:</p>
        <ul>
            <li><strong>Critical Services:</strong> Essential system services (Apache, MySQL, PostgreSQL, etc.)</li>
            <li><strong>Other Services:</strong> Additional services running on the server</li>
        </ul>
    </div>

    <div class="help-section">
        <h2>Alert Configuration</h2>
        <p>Configure email alerts to be notified when issues are detected.</p>
        
        <h3>Setting Up Email Alerts</h3>
        <p>Navigate to "Notifications" → "Alert Config" to configure:</p>
        <ul>
            <li>SMTP server settings</li>
            <li>Email recipients</li>
            <li>Alert thresholds</li>
            <li>Test email delivery</li>
        </ul>

        <h3>Alert Types</h3>
        <p>You'll receive alerts for:</p>
        <ul>
            <li>CPU usage exceeding thresholds</li>
            <li>Memory usage warnings</li>
            <li>Disk space alerts</li>
            <li>Service failures</li>
            <li>Anomaly detections</li>
        </ul>
    </div>

    <div class="help-section">
        <h2>User Management</h2>
        <p>Manage user access and permissions (Superuser only).</p>
        
        <h3>User Roles</h3>
        <ul>
            <li><strong>Superuser:</strong> Full access to all features</li>
            <li><strong>Staff User:</strong> Limited access based on ACL permissions</li>
        </ul>

        <h3>Access Control (ACL)</h3>
        <p>For staff users, you can configure:</p>
        <ul>
            <li>Dashboard viewing permissions</li>
            <li>Threshold editing rights</li>
            <li>Monitoring control permissions</li>
            <li>Server management permissions (add/edit/delete)</li>
        </ul>
    </div>

    <div class="help-section">
        <h2>Key Features</h2>
        <div class="feature-list">
            <div class="feature-card">
                <h4>Real-Time Monitoring</h4>
                <p>Live updates of server metrics every 60 seconds (configurable)</p>
            </div>
            <div class="feature-card">
                <h4>Anomaly Detection</h4>
                <p>AI-powered anomaly detection using ADTK and correlation analysis</p>
            </div>
            <div class="feature-card">
                <h4>Service Tracking</h4>
                <p>Monitor critical services and receive alerts on failures</p>
            </div>
            <div class="feature-card">
                <h4>Historical Data</h4>
                <p>View metric trends and anomaly history with interactive charts</p>
            </div>
            <div class="feature-card">
                <h4>Alert Management</h4>
                <p>Configure email alerts and manage notification preferences</p>
            </div>
            <div class="feature-card">
                <h4>Access Control</h4>
                <p>Granular permissions for staff users with ACL settings</p>
            </div>
        </div>
    </div>

    <div class="help-section">
        <h2>Tips & Best Practices</h2>
        <ul>
            <li>Set appropriate alert thresholds based on your server's normal usage patterns</li>
            <li>Enable monitoring for critical services to catch failures early</li>
            <li>Review anomaly history regularly to identify patterns</li>
            <li>Use the halt monitoring feature when performing maintenance</li>
            <li>Configure email alerts to ensure timely notifications</li>
            <li>Regularly review and update user permissions as needed</li>
        </ul>
    </div>
</div>
{% endblock %}

